name: dispatcher_runner

on:
  schedule:
    - cron: '* * * * *'  
  workflow_dispatch:
  push:  

jobs:
  dispatcher_runner:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4.2.2


      - name: Set up uv
        run: curl -LsSf https://astral.sh/uv/install.sh | sh
        
      - name: Install Dependencies
        run: uv sync

      - name: Run Script
        run: cd senders && uv run python -m scripts.run_all_dispatchers
        env: 
            DB: ${{ secrets.TEST_DB }}
            LINE_CHANNEL_SECRET: ${{ secrets.LINE_CHANNEL_SECRET }}
            LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
            TEST_USER_ID: ${{ secrets.TEST_USER_ID }}
            ADMIN_LINE_ID: ${{ secrets.ADMIN_LINE_ID }}
            FORM_WEB_URL: ${{ secrets.FORM_WEB_URL }}
