{% extends "base.html" %}

{% block title %}
提交地點
{% endblock %}


{% block content %}


<form class="needs-validation" method="post" novalidate>
    {{ form.hidden_tag() }}

    <div class="row g-3">

        {% for i in range(1, 3) %}
        {# Get both fields dynamically #}
        {% set name_field = form['place' ~ i ~ '_name'] %}
        {% set id_field = form['place' ~ i ~ '_id'] %}

        <div class="col-12 mb-3">
            {{ name_field.label(class="form-label") }}{% if i != 1 %}<span class="text-body-secondary">(選填)</span>{%
            endif %}

            {{ name_field(class="form-control" + (" is-invalid" if id_field.errors else ""),
            id="place_input_" ~ i,
            placeholder="搜尋餐廳名稱...") }}

            {{ id_field(id="place_id_" ~ i, style="display:none;") }}


            {% for error in id_field.errors %}
            <div class="invalid-feedback">
                {{ error }}
            </div>
            {% endfor %}
        </div>
        {% endfor %}


        {% for i in range(1, 4) %}
        {% set field = form['date' ~ i] %}

        <div class="col-12 mb-3">
            {{ field.label(class="form-label") }}
            {% if i != 1 %}<span class="text-body-secondary">(選填)</span>{% endif %}

            <div class="input-group">
                {{ field(class="form-control mb-2" + (" is-invalid" if field.errors else ""),
                type="date") }}

                {% for error in field.errors %}
                <div class="invalid-feedback">
                    {{ error }}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}


        <div class="col-md-12">
            {{ form.comment.label(class="form-label") }}
            {{ form.comment(class="form-control" + (" is-invalid" if form.comment.errors else ""),
            rows="4",
            placeholder="輸入您想對對方說的話...") }}

            {% for error in form.comment.errors %}
            <div class="invalid-feedback">
                {{ error }}
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="d-flex justify-content-center gap-3 mt-4 mb-5">
        <button class="w-50 btn btn-primary btn-lg" type="submit">確認送出</button>
        {% if go_back_url %}
        <a href="{{ go_back_url }}" class="w-50 btn btn-outline-secondary btn-lg">返回上頁</a>
        {% endif %}
    </div>
</form>



<script>(g => { var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window; b = b[c] || (b[c] = {}); var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => { await (a = m.createElement("script")); e.set("libraries", [...r] + ""); for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]); e.set("callback", c + ".maps." + q); a.src = `https://maps.${c}apis.com/maps/api/js?` + e; d[q] = f; a.onerror = () => h = n(Error(p + " could not load.")); a.nonce = m.querySelector("script[nonce]")?.nonce || ""; m.head.append(a) })); d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)) })
        ({ key: "{{ config.GOOGLE_MAPS_API_KEY }}", v: "weekly" });</script>
<script src="{{ url_for('static', filename='maps.js') }}"></script>
{% endblock %}