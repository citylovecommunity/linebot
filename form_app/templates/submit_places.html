{% extends "base.html" %}


{% block title %}
提交地點
{% endblock %}




{% block content %}
<h2 class="card-title mb-4">{{dating_title}}</h2>

<p>
    {{first_word | safe}}
</p>
<form method="post" action="{{ post_to }}">

    <!-- 地點 Section -->
    <div class="mb-3" id="place-section">
        <div class="section-header">
            <label class="form-label">地點 Google Maps 連結</label>
            {% if lock %}
            <button type="button" class="btn btn-outline-secondary lock-btn"
                onclick="toggleSectionLock('place-section', this)">🔒</button>
            {% endif %}
        </div>

        {% for i in range(1, 3) %}
        <input type="url" class="form-control {% if i == 1 %}mb-2{% endif %}" id="place{{ i }}" name="place{{ i }}"
            required {% if lock %} readonly {% endif %}
            value="{{ session['confirm_data']['place' ~ i ~ '_url'] if session.get('confirm_data') else '' }}">
        {% endfor %}


    </div>

    <!-- 時間 Section -->
    <div class="mb-3" id="time-section">
        <div class="section-header">
            <label class="form-label">選擇三個時間</label>
            {% if lock %}
            <button type="button" class="btn btn-outline-secondary lock-btn"
                onclick="toggleSectionLock('time-section', this)">🔒</button>
            {% endif %}
        </div>
        {% for i in range(1, 4) %}
        <input type="datetime-local" class="form-control mb-2" id="time{{ i }}" name="time{{ i }}" required {% if lock
            %} readonly {% endif %}
            value="{{ session['confirm_data']['time' ~ i] if session.get('confirm_data') else '' }}">
        {% endfor %}
    </div>
    <p>
        {{second_word | safe}}
    </p>
    <!-- 留言 Section (no lock) -->
    <div class="mb-3">
        <label for="comment" class="form-label">留言給對方（選填）</label>
        <textarea class="form-control" id="comment" name="comment" rows="3"
            placeholder="輸入您想對對方說的話...">{{ session['confirm_data']['comment'] if session.get('confirm_data') else '' }}</textarea>
    </div>

    <!-- 提交按鈕 -->
    <div class="text-center">
        <button type="submit" class="btn btn-success me-2">確認送出</button>
        {% if go_back_url %}
        <a href="{{ go_back_url }}" class="btn btn-outline-secondary">返回上頁</a>
        {% endif %}
    </div>
</form>

{% if lock %}
<script>
    function toggleSectionLock(sectionId, btn) {
        const section = document.getElementById(sectionId);
        const inputs = section.querySelectorAll('input');
        const isLocked = inputs[0].hasAttribute('readonly');

        inputs.forEach(input => {
            if (isLocked) {
                input.removeAttribute('readonly');
            } else {
                input.setAttribute('readonly', true);
            }
        });

        btn.textContent = isLocked ? '🔓' : '🔒';
    }
</script>
{% endif %}

{% endblock %}