{% extends "base.html" %}


{% block title %}
提交地點
{% endblock %}


{% block content %}


<form class="needs-validation" method="post" action="{{ post_to }}">
    <div class="row g-3">

        {% for i in range(1,3) %}
        <div class="col-12 mb-3">
            <label for="place{{i}}" class="form-label">第{{i}}間餐廳</label>
            {% if i != 1%}<span class="text-body-secondary">(選填)</span> {% endif %}
            <div class="input-group">
                <input type="url" class="form-control" id="place{{i}}" name="place{{i}}" {% if i==1 %} required {% endif
                    %} {% if lock %} disabled {% endif %}
                    value="{{ session['confirm_data']['place' ~ i ~ '_url'] if session['confirm_data'] else '' }}">
                {% if lock %}
                <button class="btn btn-outline-secondary ms-2" type="button"
                    onclick="enableInput('place{{i}}')">清空重填</button>
                {% endif %}
            </div>
            <div class="invalid-feedback">
                請輸入有效的 Google Map 網址。
            </div>
        </div>
        {% endfor %}


        {% for i in range(1, 4) %}
        <div class="col-12 mb-3">
            <label for="date{{i}}" class="form-label">日期{{i}}</label>
            {% if i != 1%}<span class="text-body-secondary">(選填)</span> {% endif %}
            <div class="input-group">
                <input type="date" class="form-control mb-2" id="date{{i}}" name="date{{i}}" {% if i==1 %} required {%
                    endif %} {% if lock %} disabled {% endif %}
                    value="{{ session['confirm_data']['date' ~ i] if session['confirm_data'] else '' }}">
                {% if lock %}
                <button class="btn btn-outline-secondary  ms-2" type="button"
                    onclick="enableInput('date{{i}}')">清空重填</button>
                {% endif %}
            </div>
        </div>
        {% endfor %}


        <div class="col-md-12">
            <label for="comment" class="form-label">留言給對方 </label>
            <textarea class="form-control" id="comment" name="comment" rows="4" required
                placeholder="輸入您想對對方說的話..."></textarea>
        </div>
    </div>

    <div class="d-flex justify-content-center gap-3 mt-4 mb-5">
        <button class="w-50 btn btn-primary btn-lg" type="submit">確認送出</button>
        {% if go_back_url %}
        <a href="{{ go_back_url }}" class="w-50 btn btn-outline-secondary btn-lg">返回上頁</a>
        {% endif %}
    </div>
</form>

{% if lock %}
<script>
    function enableInput(inputId) {
        var input = document.getElementById(inputId);
        input.removeAttribute('disabled');
        input.value = ''; // Clear the value
        input.focus();
    }
    document.querySelector('form.needs-validation').addEventListener('submit', function (e) {
        // Enable all disabled inputs before submit
        this.querySelectorAll('input:disabled').forEach(function (input) {
            input.removeAttribute('disabled');
        });
    });
</script>
{% endif %}

<script>(g => { var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window; b = b[c] || (b[c] = {}); var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => { await (a = m.createElement("script")); e.set("libraries", [...r] + ""); for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]); e.set("callback", c + ".maps." + q); a.src = `https://maps.${c}apis.com/maps/api/js?` + e; d[q] = f; a.onerror = () => h = n(Error(p + " could not load.")); a.nonce = m.querySelector("script[nonce]")?.nonce || ""; m.head.append(a) })); d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)) })
        ({ key: "{{ config.GOOGLE_MAPS_API_KEY }}", v: "weekly" });</script>
<script src="{{ url_for('static', filename='maps.js') }}"></script>
{% endblock %}